<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F2K MULTISERVICE - Annonces</title>
    <!-- Firebase SDK -->
    <script type="module" src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        .top-bar {
            background: #2c3e50;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .logo {
            color: white;
            font-size: 1.5em;
            font-weight: bold;
        }
        .nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .nav-btn {
            color: white;
            text-decoration: none;
            padding: 8px 20px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-size: 0.9em;
        }
        .btn-connect { background: #27ae60; }
        .btn-admin { background: #e67e22; }
        .btn-deconnect { background: #e74c3c; }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .hero {
            background: #2c3e50;
            color: white;
            padding: 60px 40px;
            text-align: center;
            border-radius: 10px;
            margin: 20px 0 40px;
        }
        .hero h1 { font-size: 2.8em; margin-bottom: 15px; }
        .hero p { font-size: 1.3em; opacity: 0.9; }
        
        .offres-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }
        .offre-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .offre-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        .offre-content {
            padding: 20px;
        }
        .offre-titre {
            color: #2c3e50;
            font-size: 1.3em;
            margin-bottom: 10px;
        }
        .offre-tags {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .offre-tag {
            background: #e67e22;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
        }
        .offre-description {
            color: #555;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        .btn-postuler {
            width: 100%;
            background: #2c3e50;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }
        .btn-postuler:hover { background: #e67e22; }
        
        .contact-info {
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin: 40px 0;
        }
        .contact-details {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        .contact-item a {
            color: #e67e22;
            text-decoration: none;
        }
        
        /* MODALES */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
        }
        .modal-content {
            background: white;
            width: 90%;
            max-width: 800px;
            margin: 50px auto;
            padding: 30px;
            border-radius: 10px;
            position: relative;
        }
        .close {
            position: absolute;
            right: 20px; top: 10px;
            font-size: 2em;
            cursor: pointer;
        }
        .modal input, .modal select, .modal textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .modal button {
            width: 100%;
            padding: 12px;
            background: #e67e22;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
        }
        .phone-row {
            display: flex;
            gap: 10px;
        }
        .phone-prefix {
            width: 80px;
            padding: 10px;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab-btn {
            flex: 1;
            padding: 15px;
            background: #f0f0f0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            min-width: 120px;
        }
        .tab-btn.active {
            background: #e67e22;
            color: white;
        }
        .candidat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            background: #f9f9f9;
            margin: 5px 0;
            border-radius: 5px;
        }
        .candidat-info { flex: 1; }
        .candidat-info strong { color: #2c3e50; }
        .candidat-info small { color: #666; display: block; }
        .candidat-actions { display: flex; gap: 10px; }
        .btn-ban { background: #e74c3c; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer; }
        .btn-unban { background: #27ae60; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer; }
        .btn-delete { background: #c0392b; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer; }
        .badge-banni { background: #e74c3c; color: white; padding: 3px 10px; border-radius: 20px; font-size: 0.8em; margin-left: 10px; }
        .badge-non-verifie { background: #f39c12; color: white; padding: 3px 10px; border-radius: 20px; font-size: 0.8em; margin-left: 10px; }
        .loading { text-align: center; padding: 50px; color: #666; }
        .preview-image { max-width: 200px; max-height: 200px; margin: 10px 0; display: none; }
        .user-greeting { color: white; margin-right: 15px; font-weight: bold; }
        .login-box {
            background: white;
            max-width: 400px;
            margin: 100px auto;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .error-message { color: #e74c3c; text-align: center; margin: 10px 0; }
        .success-message { color: #27ae60; text-align: center; margin: 10px 0; }
        footer { text-align: center; padding: 20px; color: #666; }
    </style>
</head>
<body>
    <!-- HEADER -->
    <div class="top-bar">
        <div class="logo">üåê F2K MULTISERVICE</div>
        <div style="display: flex; align-items: center; gap: 10px;">
            <span id="user-greeting" class="user-greeting"></span>
            <div class="nav-buttons">
                <button class="nav-btn btn-connect" onclick="afficherConnexion()" id="connectBtn">üîê Se connecter</button>
                <button class="nav-btn btn-admin" onclick="afficherAdmin()">‚öôÔ∏è Admin</button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- BANNIERE -->
        <div class="hero">
            <h1>F2K MULTISERVICE</h1>
            <p>D√©couvrez toutes nos annonces dans le monde entier üåç</p>
        </div>

        <!-- ANNONCES -->
        <h2 style="color: #2c3e50;">üì¢ Annonces disponibles</h2>
        <div id="offres-container" class="offres-grid">
            <div class="loading">Chargement des annonces...</div>
        </div>

        <!-- CONTACT -->
        <div class="contact-info">
            <h3>üìû Contactez-nous</h3>
            <div class="contact-details">
                <div class="contact-item">üìß <a href="mailto:f2kmultiservice@gmail.com">f2kmultiservice@gmail.com</a></div>
                <div class="contact-item">üì± <a href="https://wa.me/2290199878742" target="_blank">WhatsApp: +229 01 99 87 87 42</a></div>
            </div>
        </div>
        
        <footer>
            <p>&copy; 2025 F2K MULTISERVICE - Tous droits r√©serv√©s</p>
        </footer>
        </div>    <!-- MODALE DE CONNEXION -->
    <div id="modal-connexion" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <span class="close" onclick="fermerModal('modal-connexion')">&times;</span>
            <h2>üîê Connexion</h2>
            <div id="login-error" style="color: red; margin-bottom: 10px;"></div>
            <div id="login-success" class="success-message"></div>
            <input type="email" id="login-email" placeholder="Email" required>
            <input type="password" id="login-password" placeholder="Mot de passe" required>
            <button onclick="connecter()">Se connecter</button>
            <p style="text-align: center;">Pas encore de compte ? <a href="#" onclick="afficherInscription(); return false;">S'inscrire</a></p>
        </div>
    </div>

    <!-- MODALE D'INSCRIPTION -->
    <div id="modal-inscription" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <span class="close" onclick="fermerModal('modal-inscription')">&times;</span>
            <h2>üìù Inscription</h2>
            <div id="register-error" style="color: red; margin-bottom: 10px;"></div>
            <div id="register-success" class="success-message"></div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <input type="text" id="reg-nom" placeholder="Nom" required>
                <input type="text" id="reg-prenom" placeholder="Pr√©nom" required>
            </div>
            <input type="email" id="reg-email" placeholder="Email" required>
            <select id="reg-pays" required>
                <option value="">S√©lectionnez votre pays</option>
                <option value="B√©nin">B√©nin (+229)</option>
                <option value="C√¥te d'Ivoire">C√¥te d'Ivoire (+225)</option>
                <option value="S√©n√©gal">S√©n√©gal (+221)</option>
                <option value="Togo">Togo (+228)</option>
                <option value="Cameroun">Cameroun (+237)</option>
                <option value="France">France (+33)</option>
                <option value="Belgique">Belgique (+32)</option>
                <option value="Canada">Canada (+1)</option>
            </select>
            <div class="phone-row">
                <span class="phone-prefix" id="indicatif">+229</span>
                <input type="tel" id="reg-telephone" placeholder="Num√©ro WhatsApp" style="flex:1;" required>
            </div>
            <input type="password" id="reg-password" placeholder="Mot de passe (min 6 caract√®res)" required>
            <input type="password" id="reg-confirm" placeholder="Confirmer mot de passe" required>
            <button onclick="inscrire()">Cr√©er mon compte</button>
            <p style="text-align: center;">D√©j√† un compte ? <a href="#" onclick="afficherConnexion(); return false;">Se connecter</a></p>
        </div>
    </div>

    <!-- MODALE ADMIN -->
    <div id="modal-admin" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fermerModal('modal-admin')">&times;</span>
            <h2>‚öôÔ∏è Administration</h2>
            
            <div id="admin-login" style="display: block;">
                <h3>Connexion admin</h3>
                <div id="admin-error" class="error-message"></div>
                <input type="email" id="admin-email" placeholder="Email admin">
                <input type="password" id="admin-password" placeholder="Mot de passe">
                <button onclick="connecterAdmin()">Se connecter</button>
            </div>

            <div id="admin-panel" style="display: none;">
                <div class="admin-tabs">
                    <button class="tab-btn active" onclick="changerOnglet('publier')">‚ûï Publier</button>
                    <button class="tab-btn" onclick="changerOnglet('offres')">üìã G√©rer annonces</button>
                    <button class="tab-btn" onclick="changerOnglet('candidats')">üë• G√©rer candidats</button>
                </div>

                <div id="onglet-publier">
                    <h3>Nouvelle annonce</h3>
                    <input type="text" id="offre-titre" placeholder="Titre de l'annonce">
                    <textarea id="offre-description" placeholder="Description" rows="4"></textarea>
                    <select id="offre-type">
                        <option>Annonce g√©n√©rale</option>
                        <option>Offre d'emploi</option>
                        <option>√âv√©nement</option>
                        <option>Information</option>
                    </select>
                    <input type="text" id="offre-localisation" placeholder="Localisation" value="International">
                    <input type="file" id="offre-image" accept="image/*">
                    <img id="image-preview" class="preview-image">
                    <button onclick="publierOffre()">Publier l'annonce</button>
                </div>

                <div id="onglet-offres" style="display: none;">
                    <h3>Annonces publi√©es</h3>
                    <div id="offres-list" class="item-list"></div>
                </div>

                <div id="onglet-candidats" style="display: none;">
                    <h3>Candidats inscrits</h3>
                    <div id="candidats-list" class="item-list"></div>
                </div>
            </div>
        </div>
                    </div>    <script type="module">
        // ========== CONFIGURATION FIREBASE ==========
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { 
            getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy, updateDoc, where 
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { 
            getStorage, ref, uploadBytes, getDownloadURL 
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            createUserWithEmailAndPassword, 
            sendEmailVerification,
            signOut, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCvnb4ZgcoJtXiJW0ojfSR7ag9KDbOzqA0",
            authDomain: "recrutement-f2k-multiservice.firebaseapp.com",
            projectId: "recrutement-f2k-multiservice",
            storageBucket: "recrutement-f2k-multiservice.firebasestorage.app",
            messagingSenderId: "960700922367",
            appId: "1:960700922367:web:63eb70c336a22f37044fca"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);
        const auth = getAuth(app);

        // ========== VARIABLES GLOBALES ==========
        let utilisateurConnecte = null;
        let candidatInfo = null;
        const adminEmails = ['admin@f2kmultiservice.com', 'f2kmultiservice@gmail.com'];

        // ========== GESTION AUTH ==========
        onAuthStateChanged(auth, async (user) => {
            utilisateurConnecte = user;
            if (user && user.emailVerified) {
                const q = query(collection(db, "candidats"), where("uid", "==", user.uid));
                const snapshot = await getDocs(q);
                if (!snapshot.empty) {
                    candidatInfo = snapshot.docs[0].data();
                    document.getElementById('user-greeting').textContent = `üëã Bonjour, ${candidatInfo.prenom}`;
                }
            } else {
                candidatInfo = null;
                document.getElementById('user-greeting').textContent = '';
            }
            majBoutonConnexion();
        });

        function majBoutonConnexion() {
            const btn = document.getElementById('connectBtn');
            if (utilisateurConnecte) {
                btn.textContent = 'üîê D√©connexion';
                btn.classList.remove('btn-connect');
                btn.classList.add('btn-deconnect');
                btn.onclick = deconnexion;
            } else {
                btn.textContent = 'üîê Se connecter';
                btn.classList.remove('btn-deconnect');
                btn.classList.add('btn-connect');
                btn.onclick = afficherConnexion;
            }
        }

        window.deconnexion = async function() {
            await signOut(auth);
            fermerModal('modal-connexion');
            fermerModal('modal-inscription');
            fermerModal('modal-admin');
            location.reload();
        };

        // ========== MODALES ==========
        window.afficherConnexion = function() {
            fermerModal('modal-inscription');
            fermerModal('modal-admin');
            document.getElementById('modal-connexion').style.display = 'block';
        };

        window.afficherInscription = function() {
            fermerModal('modal-connexion');
            fermerModal('modal-admin');
            document.getElementById('modal-inscription').style.display = 'block';
        };

        window.afficherAdmin = function() {
            fermerModal('modal-connexion');
            fermerModal('modal-inscription');
            document.getElementById('modal-admin').style.display = 'block';
        };

        window.fermerModal = function(id) {
            document.getElementById(id).style.display = 'none';
        };

        // Mise √† jour indicatif pays
        document.getElementById('reg-pays')?.addEventListener('change', function() {
            const indicatifs = {
                'B√©nin': '+229',
                'C√¥te d\'Ivoire': '+225',
                'S√©n√©gal': '+221',
                'Togo': '+228',
                'Cameroun': '+237',
                'France': '+33',
                'Belgique': '+32',
                'Canada': '+1'
            };
            document.getElementById('indicatif').textContent = indicatifs[this.value] || '+229';
        });

        // Pr√©visualisation image
        document.getElementById('offre-image')?.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('image-preview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        // ========== CONNEXION CANDIDAT AVEC V√âRIFICATION EMAIL ==========
        window.connecter = async function() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorDiv = document.getElementById('login-error');
            const successDiv = document.getElementById('login-success');
            
            errorDiv.textContent = '';
            successDiv.textContent = '';

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                if (!user.emailVerified) {
                    await signOut(auth);
                    
                    if (confirm('‚ùå Votre email n\'a pas encore √©t√© v√©rifi√©. Voulez-vous renvoyer l\'email de confirmation ?')) {
                        await sendEmailVerification(user);
                        successDiv.textContent = '‚úÖ Un nouvel email de confirmation a √©t√© envoy√© √† ' + email;
                    }
                    
                    errorDiv.textContent = 'Veuillez v√©rifier votre email avant de vous connecter.';
                    return;
                }
                
                const q = query(collection(db, "candidats"), where("email", "==", email));
                const snapshot = await getDocs(q);
                
                if (!snapshot.empty) {
                    const candidat = snapshot.docs[0].data();
                    
                    const docRef = snapshot.docs[0].ref;
                    await updateDoc(docRef, { emailVerifie: true });
                    
                    if (candidat.banni) {
                        await signOut(auth);
                        errorDiv.textContent = '‚ùå Ce compte a √©t√© banni.';
                        return;
                    }
                }
                
                successDiv.textContent = '‚úÖ Connexion r√©ussie !';
                setTimeout(() => {
                    fermerModal('modal-connexion');
                    location.reload();
                }, 1500);
                
            } catch (error) {
                errorDiv.textContent = 'Email ou mot de passe incorrect';
            }
        };        // ========== INSCRIPTION CANDIDAT AVEC CONFIRMATION EMAIL ==========
        window.inscrire = async function() {
            const nom = document.getElementById('reg-nom').value;
            const prenom = document.getElementById('reg-prenom').value;
            const email = document.getElementById('reg-email').value;
            const pays = document.getElementById('reg-pays').value;
            const indicatif = document.getElementById('indicatif').textContent;
            const telephone = document.getElementById('reg-telephone').value.replace(/\s/g, '');
            const password = document.getElementById('reg-password').value;
            const confirm = document.getElementById('reg-confirm').value;
            const errorDiv = document.getElementById('register-error');
            const successDiv = document.getElementById('register-success');

            errorDiv.textContent = '';
            successDiv.textContent = '';

            if (!nom || !prenom || !email || !pays || !telephone || !password) {
                errorDiv.textContent = 'Tous les champs sont obligatoires';
                return;
            }

            if (password !== confirm) {
                errorDiv.textContent = 'Les mots de passe ne correspondent pas';
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                await sendEmailVerification(user);
                
                await addDoc(collection(db, "candidats"), {
                    uid: user.uid,
                    nom: nom,
                    prenom: prenom,
                    email: email,
                    pays: pays,
                    telephone: `${indicatif}${telephone}`,
                    dateInscription: new Date(),
                    banni: false,
                    emailVerifie: false
                });

                await signOut(auth);
                
                successDiv.textContent = '‚úÖ Inscription r√©ussie ! Un email de confirmation a √©t√© envoy√©. V√©rifiez votre bo√Æte de r√©ception.';
                
                setTimeout(() => {
                    fermerModal('modal-inscription');
                    afficherConnexion();
                }, 3000);
                
            } catch (error) {
                if (error.code === 'auth/email-already-in-use') {
                    errorDiv.textContent = 'Cet email est d√©j√† utilis√©';
                } else {
                    errorDiv.textContent = 'Erreur: ' + error.message;
                }
            }
        };

        // ========== ADMIN ==========
        window.connecterAdmin = async function() {
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            const errorDiv = document.getElementById('admin-error');

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                if (!adminEmails.includes(email)) {
                    await signOut(auth);
                    errorDiv.textContent = 'Acc√®s non autoris√©';
                    return;
                }
                
                if (!user.emailVerified) {
                    errorDiv.textContent = 'Veuillez v√©rifier votre email admin';
                    return;
                }
                
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                chargerOffresAdmin();
                chargerCandidatsAdmin();
            } catch (error) {
                errorDiv.textContent = 'Email ou mot de passe incorrect';
            }
        };

        window.changerOnglet = function(onglet) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('onglet-publier').style.display = onglet === 'publier' ? 'block' : 'none';
            document.getElementById('onglet-offres').style.display = onglet === 'offres' ? 'block' : 'none';
            document.getElementById('onglet-candidats').style.display = onglet === 'candidats' ? 'block' : 'none';
            
            if (onglet === 'candidats') chargerCandidatsAdmin();
            if (onglet === 'offres') chargerOffresAdmin();
        };

        window.publierOffre = async function() {
            const titre = document.getElementById('offre-titre').value;
            const description = document.getElementById('offre-description').value;
            const type = document.getElementById('offre-type').value;
            const localisation = document.getElementById('offre-localisation').value;
            const imageFile = document.getElementById('offre-image').files[0];

            if (!titre || !description) {
                alert('Veuillez remplir le titre et la description');
                return;
            }

            try {
                let imageUrl = '';
                if (imageFile) {
                    const storageRef = ref(storage, `offres/${Date.now()}_${imageFile.name}`);
                    const snapshot = await uploadBytes(storageRef, imageFile);
                    imageUrl = await getDownloadURL(snapshot.ref);
                }

                await addDoc(collection(db, "offres"), {
                    titre: titre,
                    description: description,
                    type: type,
                    localisation: localisation,
                    imageUrl: imageUrl,
                    dateCreation: new Date()
                });

                alert('‚úÖ Annonce publi√©e !');
                document.getElementById('offre-titre').value = '';
                document.getElementById('offre-description').value = '';
                document.getElementById('offre-type').value = 'Annonce g√©n√©rale';
                document.getElementById('offre-localisation').value = 'International';
                document.getElementById('offre-image').value = '';
                document.getElementById('image-preview').style.display = 'none';
                chargerOffres();
                chargerOffresAdmin();
            } catch (error) {
                alert('Erreur: ' + error.message);
            }
        };

        async function chargerOffresAdmin() {
            const container = document.getElementById('offres-list');
            const q = query(collection(db, "offres"), orderBy("dateCreation", "desc"));
            const snapshot = await getDocs(q);
            
            if (snapshot.empty) {
                container.innerHTML = '<p style="text-align:center; padding:20px;">Aucune annonce publi√©e</p>';
                return;
            }

            let html = '';
            snapshot.forEach(doc => {
                const offre = doc.data();
                html += `
                    <div class="candidat-item">
                        <div class="candidat-info">
                            <strong>${offre.titre}</strong><br>
                            <small>${offre.localisation} - ${offre.type}</small>
                        </div>
                        <button class="btn-delete" onclick="supprimerOffre('${doc.id}')">Supprimer</button>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        window.supprimerOffre = async function(id) {
            if (confirm('Supprimer cette annonce ?')) {
                await deleteDoc(doc(db, "offres", id));
                chargerOffres();
                chargerOffresAdmin();
                alert('‚úÖ Annonce supprim√©e');
            }
        };

        async function chargerCandidatsAdmin() {
            const container = document.getElementById('candidats-list');
            const q = query(collection(db, "candidats"), orderBy("dateInscription", "desc"));
            const snapshot = await getDocs(q);
            
            if (snapshot.empty) {
                container.innerHTML = '<p style="text-align:center; padding:20px;">Aucun candidat inscrit</p>';
                return;
            }

            let html = '';
            for (const docSnapshot of snapshot.docs) {
                const candidat = docSnapshot.data();
                const date = candidat.dateInscription?.toDate ? 
                    candidat.dateInscription.toDate().toLocaleDateString('fr-FR') : '';
                
                html += `
                    <div class="candidat-item">
                        <div class="candidat-info">
                            <strong>${candidat.prenom || ''} ${candidat.nom || ''}</strong>
                            ${candidat.banni ? '<span class="badge-banni">Banni</span>' : ''}
                            ${!candidat.emailVerifie ? '<span class="badge-non-verifie">Email non v√©rifi√©</span>' : ''}
                            <br>
                            <small>üìß ${candidat.email || ''}</small>
                            <br>
                            <small>üì± ${candidat.telephone || ''} | ${candidat.pays || ''}</small>
                            <br>
                            <small>üìÖ Inscrit le ${date}</small>
                        </div>
                        <div class="candidat-actions">
                            ${candidat.banni ? 
                                `<button class="btn-unban" onclick="debannirCandidat('${docSnapshot.id}')">R√©activer</button>` : 
                                `<button class="btn-ban" onclick="bannirCandidat('${docSnapshot.id}')">Bannir</button>`
                            }
                            <button class="btn-delete" onclick="supprimerCandidat('${docSnapshot.id}')">Supprimer</button>
                        </div>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        window.bannirCandidat = async function(id) {
            if (confirm('Bannir ce candidat ?')) {
                await updateDoc(doc(db, "candidats", id), { banni: true });
                chargerCandidatsAdmin();
                alert('‚úÖ Candidat banni');
            }
        };

        window.debannirCandidat = async function(id) {
            if (confirm('R√©activer ce candidat ?')) {
                await updateDoc(doc(db, "candidats", id), { banni: false });
                chargerCandidatsAdmin();
                alert('‚úÖ Candidat r√©activ√©');
            }
        };

        window.supprimerCandidat = async function(id) {
            if (confirm('‚ö†Ô∏è Supprimer d√©finitivement ce candidat ? Cette action est irr√©versible.')) {
                await deleteDoc(doc(db, "candidats", id));
                chargerCandidatsAdmin();
                alert('‚úÖ Candidat supprim√© de la base');
            }
        };

        // ========== AFFICHAGE ANNONCES ==========
        async function chargerOffres() {
            const container = document.getElementById('offres-container');
            
            try {
                const q = query(collection(db, "offres"), orderBy("dateCreation", "desc"));
                const snapshot = await getDocs(q);
                
                if (snapshot.empty) {
                    container.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:50px;">Aucune annonce pour le moment</div>';
                    return;
                }

                let html = '';
                snapshot.forEach(doc => {
                    const offre = doc.data();
                    const date = offre.dateCreation?.toDate ? offre.dateCreation.toDate().toLocaleDateString('fr-FR') : '';
                    
                    html += `
                        <div class="offre-card">
                            ${offre.imageUrl ? `<img src="${offre.imageUrl}" class="offre-image">` : 
                                `<div style="height:200px; background:#667eea; display:flex; align-items:center; justify-content:center; color:white; font-size:2em;">üì∏</div>`}
                            <div class="offre-content">
                                <h3 class="offre-titre">${offre.titre || 'Sans titre'}</h3>
                                <div class="offre-tags">
                                    <span class="offre-tag">${offre.type || 'Annonce'}</span>
                                    <span class="offre-tag">üìç ${offre.localisation || 'International'}</span>
                                </div>
                                <p class="offre-description">${offre.description ? offre.description.substring(0, 150) + (offre.description.length > 150 ? '...' : '') : ''}</p>
                                <button class="btn-postuler" onclick="postuler('${offre.titre}')">Postuler</button>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            } catch (error) {
                container.innerHTML = '<div style="color:red; text-align:center;">Erreur de chargement</div>';
            }
        }

        // ========== POSTULATION ==========
        window.postuler = async function(offreTitre) {
            if (!utilisateurConnecte) {
                alert('Veuillez vous connecter pour postuler');
                afficherConnexion();
                return;
            }

            if (!candidatInfo) {
                alert('Profil non trouv√©');
                return;
            }

            if (candidatInfo.banni) {
                alert('‚ùå Votre compte a √©t√© banni. Vous ne pouvez pas postuler.');
                return;
            }

            try {
                const sujet = encodeURIComponent(`Candidature ${offreTitre} - ${candidatInfo.prenom} ${candidatInfo.nom}`);
                const corps = encodeURIComponent(
                    `Candidature pour : ${offreTitre}\n\n` +
                    `Nom : ${candidatInfo.nom} ${candidatInfo.prenom}\n` +
                    `Email : ${candidatInfo.email}\n` +
                    `T√©l√©phone : ${candidatInfo.telephone}\n` +
                    `Pays : ${candidatInfo.pays}\n\n` +
                    `Date : ${new Date().toLocaleDateString('fr-FR')}`
                );
                window.location.href = `mailto:f2kmultiservice@gmail.com?subject=${sujet}&body=${corps}`;

                setTimeout(() => {
                    if (confirm('üì± Envoyer aussi votre candidature sur WhatsApp pour une r√©ponse plus rapide ?')) {
                        const msg = encodeURIComponent(
                            `*CANDIDATURE F2K MULTISERVICE*\n\n` +
                            `Annonce : ${offreTitre}\n\n` +
                            `*Candidat :*\n` +
                            `üë§ ${candidatInfo.prenom} ${candidatInfo.nom}\n` +
                            `üìß ${candidatInfo.email}\n` +
                            `üì± ${candidatInfo.telephone}\n` +
                            `üåç ${candidatInfo.pays}\n\n` +
                            `Date : ${new Date().toLocaleDateString('fr-FR')}`
                        );
                        window.open(`https://wa.me/2290199878742?text=${msg}`, '_blank');
                    }
                }, 1000);

            } catch (error) {
                alert('Erreur lors de la candidature');
            }
        };

        // Charger les annonces au d√©marrage
        chargerOffres();
    </script>
</body>
</html>
